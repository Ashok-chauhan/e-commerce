<div class="row">
  <div class="col-md-3">
    Deliver to: <h6>{{user.name}}, {{user.pincode}}</h6>
    <p>{{user.address}}</p>
    <a href="/address/{{user.id}}"><button type="button" class="btn btn-secondary btn-sm">Edit address</button></a>
  </div>
  <div class="col-md-9">
<h2>Your Cart</h2>
{{#if items.length}}
<table class="table">
  <tr><th>Picture</th><th>Product</th><th>-</th><th>Qty</th><th>+</th><th>Price</th><th>Total</th><th>Delete</th></tr>
  {{#each items}}
    <tr>
      <td><img class="img-thumbnail cart-picture" src="/assets/images/{{this.image}}" /></td>
      <td>{{this.name}}
        <div class="fw-bold"><img src="/assets/images/{{this.swatch_picture}}"/>{{this.swatch_name}}</div>
      </td>
      <td>
        <form action="/cart/minus" method="POST">
            <input type="hidden" value={{this.cart_id}} name="cartid"/>
            <input type="hidden" value={{this.quantity}} name="quantity"/>
             <button type="submit" class="btn btn-secondary btn-sm"><strong>-</strong></button>
        </form>
      </td>
      <td >{{this.quantity}}</td>
      <td>
        <form action="/cart/plus" method="POST">
            <input type="hidden" value={{this.cart_id}} name="cartid"/>
            <input type="hidden" value={{this.quantity}} name="quantity"/>
             <button type="submit" class="btn btn-secondary btn-sm"><strong>+</strong></button>
        </form>
       </td>
      {{#if this.discount_percent}}
      <td><span class="original-price">M.R.P ₹{{multiply this.price this.quantity}}</span> <span class="discount">(-{{this.discount_percent}}% off) </span><span  class="final-price"> ₹{{multiply this.discounted_price this.quantity}}</span></td>
      <td>{{multiply this.discounted_price this.quantity}} </td>
      <td><a href="/cart/{{this.cart_id}}"> <i class="bi bi-trash3" ></i> </a></td>
      {{else}}
       <td><span  class="final-price"> ₹{{multiply this.discounted_price this.quantity}}</span></td>
      <td>{{multiply this.discounted_price this.quantity}} </td>
      <td><a href="/cart/{{this.cart_id}}"> <i class="bi bi-trash3"></i> </a></td>

      {{/if}}
    </tr>
  {{/each}}
</table>
<p><strong>Total: ₹{{total}}</strong></p>

{{!-- <form action="/checkout" method="POST">
  <button type="submit">Proceed to Pay</button>
</form> --}}

 {{!-- <h1>Pay with Razorpay</h1> --}}
    <button id="rzp-button1" class="btn btn-warning">Buy Now</button>
{{else}}
<p>Your cart is empty.</p>
{{/if}}

</div>
</div>
 <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
       
      document.getElementById("rzp-button1").onclick = async function () {
        const response = await fetch("/checkout", {
          method: "POST",
          headers: { "Content-Type": "application/json" }
        });
        const order = await response.json();
        
        var options = {
          key: order.key_id, //  Enter the Key ID generated from Razorpay Dashboard
          amount: order.amount,
          currency: order.currency,
          name: "Swagly.in",
          description: "Cosmetics & clothings",
          image:"http://localhost:3000/assets/images/swagly-circular-128x128.png",
          order_id: order.id,
        
          handler: async function (response) {
            response.amount = order.amount/100;
            const verifyRes = await fetch("/checkout/verify", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(response)
            });

            const text = await verifyRes.text();
           // alert(text);
            window.location.href = 'paymentsuccess';
            // show popup and on click ok redirect to home
          },
          
          theme: { color: "#3399cc" }
        };

        var rzp1 = new Razorpay(options);
        rzp1.open();
      };
    </script>
  

